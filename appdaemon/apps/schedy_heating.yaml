schedy_heating:  # This is our app instance name.
  module: hass_apps_loader
  class: SchedyApp

  actor_type: thermostat

  expression_environment: |
    def lola_mode():
        return state("person.lola")
    def velux_state():
        return state("binary_sensor.capteur_velux_lola_contact")
    def fenetre_state():
        return state("binary_sensor.capteur_fenetre_chambre_contact")

  schedule_append:
    - v: "OFF"
  rooms:
# CHAMBRE LOLA.
    lola:
      rescheduling_delay: 10
      actors:
        climate.thermostat_lola:
      watched_entities:
        - binary_sensor.capteur_velux_lola_contact
        - person.lola
      schedule:
        - v: 20
          rules:
            - x: "Break() if is_on('binary_sensor.capteur_velux_lola_contact') else Next()"
            - x: "Break() if  lola_mode() == 'not home'  else Next()"
            - rules:
              - weekdays: 1-5
                rules:
                  - { v: 18, start: "21:00", end: "08:00" }
                  - { v: 20, start: "08:00", end: "21:00" }
              - weekdays: 6-7
                rules:
                  - { v: 19, start: "21:00", end: "08:00" }
                  - { v: 20, start: "08:00", end: "21:00" }
            - v: "OFF"
# CHAMBRE FLO DOM.
    chambre:
      rescheduling_delay: 10
      actors:
        climate.thermostat_chambre:
      watched_entities:
        - binary_sensor.capteur_fenetre_chambre_contact
      schedule:
        - v: 18
          rules:
          - x: "Break() if is_on('binary_sensor.capteur_fenetre_chambre_contact') else Next()"
          - rules:
            - weekdays: 1-5
              rules:
                - { start: "21:00", end: "08:00" }
                - v: 18
            - weekdays: 6-7
              rules:
                - { start: "21:00", end: "15:00" }
                - v: 19
          - v: "OFF"
# SALON.
    salon:
      rescheduling_delay: 10
      actors:
        climate.thermostat_salon:
      schedule:
        - { v: 21, start: "05:00", end: "02:00", weekdays: 1-7 }


